FROM nginx:1.19
# Copy  nginx config file to container
COPY conf/nginx.conf /etc/nginx/nginx.conf

ENV WEIGHT_SEARCH_LB_2 1
ENV WEIGHT_SEARCH_LB_3 2
ENV WEIGHT_SEARCH_LB_4 3

ENV WEIGHT_SHOP_LB_2 1
ENV WEIGHT_SHOP_LB_3 2
ENV WEIGHT_SHOP_LB_4 3

ENV WEIGHT_WEB_LB_2 1
ENV WEIGHT_WEB_LB_3 2
ENV WEIGHT_WEB_LB_4 3

ENV WEIGHT_MEDIA_LB_2 1
ENV WEIGHT_MEDIA_LB_3 2
ENV WEIGHT_MEDIA_LB_4 3

ENV IP_ADDRESS_NODE_2 131.155.35.52
ENV IP_ADDRESS_NODE_3 131.155.35.53
ENV IP_ADDRESS_NODE_4 131.155.35.54

ENV PORT_ADDRESS_SEARCH 8001
ENV PORT_ADDRESS_SHOP 8002
ENV PORT_ADDRESS_WEB 8003
ENV PORT_ADDRESS_MEDIA 8004

ENV PORT_ADDRESS_SEARCH_LB 8984
ENV PORT_ADDRESS_SHOP_LB 8097
ENV PORT_ADDRESS_WEB_LB 8081
ENV PORT_ADDRESS_MEDIA_LB 8089

COPY docker-entrypoint.sh /root/service.sh
CMD ["/bin/bash","/root/service.sh"]